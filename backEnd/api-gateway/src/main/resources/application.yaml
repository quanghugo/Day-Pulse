server:
  port: 8188

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      server:
        webflux:
          routes:
            # Auth Service Routes - Public endpoints
            - id: auth-service
              uri: http://localhost:8180
              predicates:
                - Path=/api/v1/auth/**
              filters:
                - RewritePath=/api/v1/auth/(?<segment>.*), /auth-service/auth/$\{segment}
                # TODO: [FUTURE-RESILIENCE] Add rate limiting
                # - name: RequestRateLimiter
                #   args:
                #     redis-rate-limiter.replenishRate: 10
                #     redis-rate-limiter.burstCapacity: 20

            # User Service Routes - Protected endpoints
            - id: user-service
              uri: http://localhost:8181
              predicates:
                - Path=/api/v1/users/**
              filters:
                - RewritePath=/api/v1/users/(?<segment>.*), /user-service/users/$\{segment}
                # TODO: [FUTURE-RESILIENCE] Add circuit breaker
                # - name: CircuitBreaker
                #   args:
                #     name: userServiceCircuitBreaker
                #     fallbackUri: forward:/fallback/users

          # Global CORS configuration
          globalcors:
            cors-configurations:
              '[/**]':
                allowedOrigins: 
                  - "http://localhost:3000"
                  - "http://localhost:4200"
                allowedMethods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - PATCH
                  - OPTIONS
                allowedHeaders: "*"
                allowCredentials: true
                maxAge: 3600

# JWT Configuration
jwt:
  signing-key: fbX2a4nQ4tdMnfExFUl+uA9aD9IFS+csS8GP96pR75RxrCiUcEYvpn+b4wWsgJshvXMUQiDUxhEBxA9RdPj+OQ==

# Service URLs
auth-service:
  url: http://localhost:8180

# Logging
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG
    com.qnit18.api_gateway: DEBUG
